<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Système — Plateforme Multi-Hôtels 5★</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

    <!-- Panzoom for mobile zoom/pan -->
    <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #fafbfc;
            --bg-card: #ffffff;
            --bg-hover: #f7f8fa;
            --bg-surface: #f3f4f6;
            --bg-dark: #111827;
            --bg-dark-2: #1f2937;
            --border: #e5e7eb;
            --border-hover: #d1d5db;
            --text: #111827;
            --text-2: #374151;
            --text-3: #6b7280;
            --text-4: #9ca3af;
            --accent: #1d4ed8;
            --accent-light: #3b82f6;
            --accent-bg: rgba(29,78,216,0.06);
            --gold: #92700c;
            --gold-light: #b8860b;
            --gold-bg: rgba(146,112,12,0.06);
            --emerald: #047857;
            --emerald-bg: rgba(4,120,87,0.06);
            --rose: #be123c;
            --rose-bg: rgba(190,18,60,0.05);
            --violet: #6d28d9;
            --violet-bg: rgba(109,40,217,0.05);
            --cyan: #0e7490;
            --orange: #c2410c;
            --mono: 'JetBrains Mono', monospace;
            --radius: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.06), 0 2px 4px -1px rgba(0,0,0,0.04);
            --transition: all 0.2s ease;
        }

        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.65;
            -webkit-font-smoothing: antialiased;
        }
        code {
            font-family: var(--mono);
            background: var(--accent-bg);
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            color: var(--accent);
            font-weight: 500;
        }
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--text-4); border-radius: 3px; }

        /* HEADER */
        .header {
            background: var(--bg-dark);
            color: #fff;
            padding: 80px 0 64px;
            position: relative;
        }
        .header::before {
            content: '';
            position: absolute; inset: 0;
            background:
                radial-gradient(ellipse 600px 400px at 10% 60%, rgba(29,78,216,0.08), transparent 70%),
                radial-gradient(ellipse 400px 300px at 90% 40%, rgba(146,112,12,0.06), transparent 70%);
        }
        .header-inner { max-width: 1060px; margin: 0 auto; padding: 0 36px; position: relative; z-index: 1; }
        .header-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
            padding: 5px 14px; border-radius: 50px;
            font-size: 0.68rem; color: rgba(255,255,255,0.5);
            margin-bottom: 28px; letter-spacing: 0.1em; text-transform: uppercase; font-weight: 600;
        }
        .header h1 { font-size: 2.8rem; font-weight: 900; line-height: 1.1; margin-bottom: 14px; letter-spacing: -0.04em; }
        .header h1 .gold { color: #d4a843; }
        .header-sub { font-size: 1rem; color: rgba(255,255,255,0.5); max-width: 480px; }
        .header-tags { display: flex; gap: 8px; margin-top: 24px; flex-wrap: wrap; }
        .header-tag {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);
            padding: 7px 14px; border-radius: 50px; font-size: 0.82rem; color: rgba(255,255,255,0.6);
        }
        .header-meta { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
        .header-meta span { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; color: rgba(255,255,255,0.3); }

        /* NAV */
        .nav-wrap {
            position: sticky; top: 0; z-index: 100;
            background: rgba(255,255,255,0.92); backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--border);
        }
        .nav {
            max-width: 1060px; margin: 0 auto; padding: 0 36px;
            display: flex; overflow-x: auto; scrollbar-width: none;
        }
        .nav::-webkit-scrollbar { display: none; }
        .nav a {
            display: flex; align-items: center; gap: 5px;
            padding: 12px 12px; text-decoration: none; color: var(--text-3);
            font-size: 0.75rem; font-weight: 500; white-space: nowrap;
            border-bottom: 1.5px solid transparent; transition: var(--transition);
        }
        .nav a:hover, .nav a.active { color: var(--text); border-bottom-color: var(--text); }
        .nav a .n {
            width: 18px; height: 18px; border-radius: 4px; background: var(--bg-surface);
            display: inline-flex; align-items: center; justify-content: center;
            font-size: 0.62rem; font-weight: 700; color: var(--text-4);
        }

        .main { max-width: 1060px; margin: 0 auto; padding: 48px 36px 80px; }
        .section { margin-bottom: 72px; scroll-margin-top: 72px; }
        .section-header { display: flex; align-items: center; gap: 14px; margin-bottom: 36px; }
        .section-icon {
            width: 40px; height: 40px; border-radius: var(--radius);
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
            background: var(--bg-surface); border: 1px solid var(--border);
        }
        .section-number { font-size: 0.62rem; font-weight: 600; color: var(--text-4); text-transform: uppercase; letter-spacing: 0.12em; }
        .section-title { font-size: 1.6rem; font-weight: 800; letter-spacing: -0.03em; }
        .sub-title {
            display: flex; align-items: center; gap: 8px;
            font-size: 0.95rem; font-weight: 700; margin-bottom: 16px; margin-top: 12px; color: var(--text-2);
        }
        .sub-title i { color: var(--text-4); }
        .divider { height: 1px; background: var(--border); }

        /* ===== FLOW DIAGRAMS ===== */
        .flow-canvas {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }
        .flow-header {
            display: flex; align-items: center; gap: 8px;
            padding: 14px 24px;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem; font-weight: 700; color: var(--text);
            background: var(--bg-surface);
        }
        .flow-header i { color: var(--text-3); }
        .flow-header .badge {
            margin-left: auto; padding: 2px 10px; border-radius: 50px;
            background: var(--bg-card); border: 1px solid var(--border);
            font-size: 0.62rem; font-weight: 600; color: var(--text-4);
        }
        .flow-header .zoom-hint {
            display: none;
            align-items: center; gap: 4px;
            margin-left: 8px;
            font-size: 0.62rem; font-weight: 500; color: var(--text-4);
        }

        .flow-viewport {
            overflow: hidden;
            position: relative;
            cursor: grab;
            touch-action: none;
        }
        .flow-viewport:active { cursor: grabbing; }

        .flow-body {
            position: relative;
            /* Fixed width so nodes never collapse */
            width: 900px;
            min-height: 400px;
            transform-origin: 0 0;
        }
        .flow-body svg.connections {
            position: absolute; inset: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }
        .flow-body svg.connections path { fill: none; stroke-width: 1.2; }

        .flow-node {
            position: absolute;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 10px 14px;
            display: flex; align-items: center; gap: 10px;
            min-width: 130px;
            transition: border-color 0.2s, box-shadow 0.2s;
            z-index: 2;
            box-shadow: var(--shadow-sm);
            white-space: nowrap;
        }
        .flow-node:hover { box-shadow: var(--shadow-md); border-color: var(--border-hover); }
        .flow-node .fn-icon {
            width: 30px; height: 30px; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; background: var(--bg-surface);
        }
        .flow-node .fn-title { font-size: 0.76rem; font-weight: 700; color: var(--text); line-height: 1.2; }
        .flow-node .fn-sub { font-size: 0.64rem; color: var(--text-4); line-height: 1.2; }

        .flow-node.accent { border-color: rgba(29,78,216,0.2); }
        .flow-node.gold { border-color: rgba(146,112,12,0.2); }
        .flow-node.emerald { border-color: rgba(4,120,87,0.2); }
        .flow-node.dark {
            background: var(--bg-dark); border-color: var(--bg-dark-2); color: #fff;
        }
        .flow-node.dark .fn-title { color: #fff; }
        .flow-node.dark .fn-sub { color: rgba(255,255,255,0.4); }
        .flow-node.dark .fn-icon { background: rgba(255,255,255,0.06); }

        /* CARDS */
        .card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 16px;
            transition: var(--transition); box-shadow: var(--shadow-sm);
        }
        .card:hover { border-color: var(--border-hover); box-shadow: var(--shadow); }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); gap: 10px; }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 10px; }

        .principle-card { display: flex; gap: 12px; align-items: flex-start; }
        .principle-icon {
            width: 36px; height: 36px; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0; background: var(--bg-surface);
        }
        .principle-content h4 { font-size: 0.85rem; font-weight: 700; margin-bottom: 1px; }
        .principle-content p { font-size: 0.78rem; color: var(--text-3); line-height: 1.45; }

        .stack-item { display: flex; align-items: center; gap: 10px; padding: 10px 14px; }
        .stack-label { font-size: 0.72rem; color: var(--text-4); min-width: 80px; font-weight: 500; }
        .stack-value { font-size: 0.82rem; font-weight: 600; }

        .file-tree { border-radius: var(--radius-lg); overflow: hidden; }
        .file-tree-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 18px; background: var(--bg-dark);
        }
        .file-tree-header-title { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; font-weight: 600; color: rgba(255,255,255,0.5); }
        .tree-dots { display: flex; gap: 5px; }
        .tree-dots span { width: 8px; height: 8px; border-radius: 50%; }
        .tree-dots span:nth-child(1) { background: #ef4444; }
        .tree-dots span:nth-child(2) { background: #eab308; }
        .tree-dots span:nth-child(3) { background: #22c55e; }
        .file-tree-body { padding: 12px 18px; }
        .tree-item { display: flex; align-items: center; gap: 6px; padding: 2px 0; font-size: 0.78rem; font-family: var(--mono); color: var(--text-3); }
        .tree-item.folder { color: var(--accent); font-weight: 600; }
        .tree-indent-1 { padding-left: 18px; }
        .tree-comment { color: var(--text-4); font-size: 0.68rem; margin-left: 6px; font-style: italic; font-family: 'Inter', sans-serif; }

        .module-card { position: relative; overflow: hidden; }
        .module-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; }
        .module-card.foundation::before { background: var(--accent); }
        .module-card.core::before { background: var(--emerald); }
        .module-card.commercial::before { background: var(--gold-light); }
        .module-card.distribution::before { background: var(--violet); }
        .module-card.support::before { background: var(--cyan); }
        .module-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px; }
        .module-num {
            width: 22px; height: 22px; border-radius: 50%;
            font-size: 0.62rem; font-weight: 800; color: #fff;
            display: flex; align-items: center; justify-content: center;
        }
        .module-num.foundation { background: var(--accent); }
        .module-num.core { background: var(--emerald); }
        .module-num.commercial { background: var(--gold-light); }
        .module-num.distribution { background: var(--violet); }
        .module-num.support { background: var(--cyan); }
        .module-name { font-size: 0.88rem; font-weight: 700; }
        .module-desc { font-size: 0.75rem; color: var(--text-3); margin-bottom: 8px; }
        .module-models { display: flex; flex-wrap: wrap; gap: 4px; }
        .model-tag { padding: 2px 8px; background: var(--bg-surface); border-radius: 50px; font-size: 0.67rem; font-weight: 600; color: var(--text-3); font-family: var(--mono); }
        .cat-badge { padding: 2px 8px; border-radius: 50px; font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; background: var(--bg-surface); color: var(--text-4); }

        .db-table { border-radius: var(--radius-lg); overflow: hidden; margin-bottom: 16px; }
        .db-table-header {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 20px; background: var(--bg-dark); color: #fff;
        }
        .db-table-name { font-family: var(--mono); font-size: 0.85rem; font-weight: 700; }
        .db-table-desc { font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-left: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        thead { background: var(--bg-surface); }
        thead th { padding: 9px 14px; text-align: left; font-weight: 600; font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-3); border-bottom: 1px solid var(--border); }
        tbody tr { border-bottom: 1px solid var(--border); }
        tbody tr:hover { background: var(--bg-surface); }
        tbody tr:last-child { border-bottom: none; }
        tbody td { padding: 7px 14px; vertical-align: top; color: var(--text-2); }
        tbody td:first-child { font-weight: 600; color: var(--text); font-family: var(--mono); font-size: 0.74rem; }
        .tag { display: inline-block; padding: 1px 6px; border-radius: 3px; font-size: 0.64rem; font-weight: 600; font-family: var(--mono); }
        .tag-pk { background: var(--gold-bg); color: var(--gold); }
        .tag-fk { background: var(--accent-bg); color: var(--accent); }
        .tag-enum { background: var(--violet-bg); color: var(--violet); }
        .tag-json { background: var(--emerald-bg); color: var(--emerald); }
        .table-wrapper.no-border { border: none; border-radius: 0; overflow-x: auto; }

        .enum-card .enum-name { font-family: var(--mono); font-size: 0.8rem; font-weight: 700; color: var(--violet); margin-bottom: 8px; }
        .enum-values { display: flex; flex-wrap: wrap; gap: 4px; }
        .enum-val { padding: 2px 9px; background: var(--bg-surface); border-radius: 50px; font-size: 0.65rem; font-family: var(--mono); color: var(--text-3); }

        .api-group { margin-bottom: 22px; }
        .api-group-title { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border); }
        .api-endpoint { display: flex; align-items: flex-start; gap: 8px; padding: 5px 8px; border-radius: 4px; margin-bottom: 1px; transition: var(--transition); }
        .api-endpoint:hover { background: var(--bg-surface); }
        .api-method { min-width: 44px; padding: 2px 0; border-radius: 3px; font-size: 0.62rem; font-weight: 800; font-family: var(--mono); text-align: center; flex-shrink: 0; }
        .method-get { background: var(--emerald-bg); color: var(--emerald); }
        .method-post { background: var(--accent-bg); color: var(--accent); }
        .method-patch { background: rgba(194,65,12,0.06); color: var(--orange); }
        .method-crud { background: var(--violet-bg); color: var(--violet); }
        .api-path { font-family: var(--mono); font-size: 0.74rem; font-weight: 600; min-width: 230px; }
        .api-desc { font-size: 0.74rem; color: var(--text-3); }

        .pay-hotel h4 { font-size: 0.88rem; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
        .pay-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid var(--border); font-size: 0.78rem; }
        .pay-row:last-child { border-bottom: none; }
        .pay-row .label { color: var(--text-3); }
        .pay-row .value { font-weight: 600; }

        .notif-card { display: flex; gap: 10px; }
        .notif-icon { width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; background: var(--bg-surface); }
        .notif-content h4 { font-size: 0.78rem; font-weight: 600; margin-bottom: 1px; }
        .notif-content p { font-size: 0.7rem; color: var(--text-4); }

        .email-item { display: grid; grid-template-columns: 170px 180px 1fr; gap: 12px; align-items: center; padding: 10px 14px; }
        .flow-trigger { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; font-weight: 600; }
        .flow-trigger i { color: var(--text-4); }
        .flow-email { font-size: 0.78rem; font-weight: 600; color: var(--accent); }
        .flow-desc { font-size: 0.72rem; color: var(--text-3); }

        .sec-card { display: flex; gap: 10px; align-items: flex-start; }
        .sec-card i { flex-shrink: 0; color: var(--text-4); }
        .sec-card h4 { font-size: 0.82rem; font-weight: 700; margin-bottom: 1px; }
        .sec-card p { font-size: 0.74rem; color: var(--text-3); }
        .role-card { margin-bottom: 8px; }
        .role-header { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .role-badge { padding: 3px 12px; border-radius: 50px; font-size: 0.72rem; font-weight: 700; background: var(--bg-surface); color: var(--text-2); }
        .role-perms { font-size: 0.78rem; color: var(--text-3); margin-bottom: 4px; }
        .role-scope { display: inline-flex; align-items: center; gap: 4px; font-size: 0.7rem; color: var(--text-4); background: var(--bg-surface); padding: 3px 10px; border-radius: 50px; }

        .audit-box { background: var(--bg-dark); border-radius: var(--radius-lg); padding: 24px; color: #fff; }
        .audit-row { display: flex; gap: 14px; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.06); font-size: 0.78rem; }
        .audit-row:last-child { border-bottom: none; }
        .audit-label { min-width: 120px; color: rgba(255,255,255,0.35); font-weight: 500; }
        .audit-value { color: rgba(255,255,255,0.8); font-family: var(--mono); font-size: 0.72rem; }
        .audit-value.gold { color: #d4a843; }
        .audit-value.red { color: #f87171; }
        .audit-value.green { color: #34d399; }

        .note {
            display: flex; align-items: flex-start; gap: 8px;
            padding: 12px 16px; background: var(--bg-surface);
            border: 1px solid var(--border); border-radius: var(--radius);
            margin: 14px 0; font-size: 0.78rem; color: var(--text-3);
        }
        .note i { flex-shrink: 0; color: var(--text-4); }

        .footer {
            background: var(--bg-dark); color: rgba(255,255,255,0.35);
            padding: 28px; text-align: center; font-size: 0.72rem;
        }
        .footer strong { color: rgba(255,255,255,0.6); }

        /* Mobile: show zoom hint, smaller grids */
        @media (max-width: 768px) {
            .header { padding: 48px 0 40px; }
            .header h1 { font-size: 1.7rem; }
            .main { padding: 24px 16px 60px; }
            .header-inner, .nav { padding: 0 16px; }
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .email-item { grid-template-columns: 1fr; }
            .api-endpoint { flex-direction: column; gap: 3px; }
            .api-path { min-width: auto; }

            .flow-header .zoom-hint { display: flex; }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="header-inner" data-aos="fade-up" data-aos-duration="600">
        <div class="header-badge"><i data-lucide="shield-check" style="width:11px;height:11px;"></i> Architecture Système</div>
        <h1>Plateforme Multi-Hôtels <span class="gold">5★</span></h1>
        <p class="header-sub">Architecture modulaire Laravel 11 — 16 modules métier</p>
        <div class="header-tags">
            <span class="header-tag"><i data-lucide="sun" style="width:14px;height:14px;color:#d4a843;"></i> Oasis Beach & Spa</span>
            <span class="header-tag"><i data-lucide="waves" style="width:14px;height:14px;color:#93c5fd;"></i> Blue Pearl Beach</span>
        </div>
        <div class="header-meta">
            <span><i data-lucide="calendar" style="width:12px;height:12px;"></i> 16/02/2026</span>
            <span><i data-lucide="code-2" style="width:12px;height:12px;"></i> Laravel 11 · nWidart</span>
            <span><i data-lucide="database" style="width:12px;height:12px;"></i> 16 Modules</span>
        </div>
    </div>
</header>

<nav class="nav-wrap">
    <div class="nav">
        <a href="#s1"><span class="n">1</span>Overview</a>
        <a href="#s2"><span class="n">2</span>Architecture</a>
        <a href="#s3"><span class="n">3</span>Modules</a>
        <a href="#s4"><span class="n">4</span>Database</a>
        <a href="#s5"><span class="n">5</span>Enums</a>
        <a href="#s6"><span class="n">6</span>API</a>
        <a href="#s7"><span class="n">7</span>Channex</a>
        <a href="#s8"><span class="n">8</span>Paiement</a>
        <a href="#s9"><span class="n">9</span>Notifications</a>
        <a href="#s10"><span class="n">10</span>Sécurité</a>
    </div>
</nav>

<main class="main">

<!-- ===== 1 ===== -->
<section class="section" id="s1">
    <div class="section-header" data-aos="fade-up"><div class="section-icon"><i data-lucide="eye" style="width:18px;height:18px;color:var(--text-3);"></i></div><div><div class="section-number">Section 01</div><h2 class="section-title">Vue d'Ensemble</h2></div></div>

    <div class="flow-canvas" data-aos="fade-up" data-aos-delay="80">
        <div class="flow-header"><i data-lucide="git-branch" style="width:14px;height:14px;"></i> Architecture Globale<span class="badge">4 Couches</span><span class="zoom-hint"><i data-lucide="move" style="width:11px;height:11px;"></i> Pinch to zoom</span></div>
        <div class="flow-viewport" data-panzoom>
            <div class="flow-body" id="arch-flow" style="min-height:520px;padding:32px;">
                <svg class="connections" id="arch-svg"><defs><marker id="ma" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M0 0L10 5L0 10z" fill="#d1d5db"/></marker></defs></svg>
                <div class="flow-node gold" id="a-oasis" style="top:16px;left:30px;"><div class="fn-icon"><i data-lucide="sun" style="width:14px;height:14px;color:var(--gold-light);"></i></div><div class="fn-text"><div class="fn-title">Oasis Beach</div><div class="fn-sub">API Publique</div></div></div>
                <div class="flow-node accent" id="a-blue" style="top:16px;left:290px;"><div class="fn-icon"><i data-lucide="waves" style="width:14px;height:14px;color:var(--accent-light);"></i></div><div class="fn-text"><div class="fn-title">Blue Pearl</div><div class="fn-sub">API Publique</div></div></div>
                <div class="flow-node" id="a-bo" style="top:16px;left:660px;"><div class="fn-icon"><i data-lucide="layout-dashboard" style="width:14px;height:14px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Back-Office</div><div class="fn-sub">JWT · Multi-Hôtels</div></div></div>
                <div class="flow-node dark" id="a-api" style="top:150px;left:260px;min-width:280px;"><div class="fn-icon"><i data-lucide="server" style="width:14px;height:14px;color:rgba(255,255,255,.5);"></i></div><div class="fn-text"><div class="fn-title">API REST v1 — Laravel 11</div><div class="fn-sub">Property Scope · 16 Modules</div></div></div>
                <div class="flow-node emerald" id="a-ch" style="top:290px;left:30px;"><div class="fn-icon"><i data-lucide="arrow-left-right" style="width:14px;height:14px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">Channex</div><div class="fn-sub">Channel Manager</div></div></div>
                <div class="flow-node" id="a-pay" style="top:290px;left:290px;"><div class="fn-icon"><i data-lucide="credit-card" style="width:14px;height:14px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">CMI / Stripe</div><div class="fn-sub">3D Secure</div></div></div>
                <div class="flow-node" id="a-mail" style="top:290px;left:660px;"><div class="fn-icon"><i data-lucide="mail" style="width:14px;height:14px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Email SMTP</div></div></div>
                <div class="flow-node" id="a-db" style="top:420px;left:120px;"><div class="fn-icon"><i data-lucide="database" style="width:14px;height:14px;color:var(--gold-light);"></i></div><div class="fn-text"><div class="fn-title">MySQL</div></div></div>
                <div class="flow-node" id="a-redis" style="top:420px;left:380px;"><div class="fn-icon"><i data-lucide="zap" style="width:14px;height:14px;color:var(--rose);"></i></div><div class="fn-text"><div class="fn-title">Redis</div></div></div>
                <div class="flow-node" id="a-otas" style="top:420px;left:640px;"><div class="fn-icon"><i data-lucide="globe" style="width:14px;height:14px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">OTAs</div></div></div>
            </div>
        </div>
    </div>

    <div class="sub-title" data-aos="fade-up"><i data-lucide="sparkles" style="width:15px;height:15px;"></i> Principes</div>
    <div class="grid-2" data-aos="fade-up">
        <div class="card principle-card"><div class="principle-icon"><i data-lucide="building-2" style="width:16px;height:16px;color:var(--accent);"></i></div><div class="principle-content"><h4>Multi-Hôtel</h4><p><code>property_id</code> scope automatique</p></div></div>
        <div class="card principle-card"><div class="principle-icon"><i data-lucide="users" style="width:16px;height:16px;color:var(--emerald);"></i></div><div class="principle-content"><h4>Cardex Centralisé</h4><p>Clients partagés entre hôtels</p></div></div>
        <div class="card principle-card"><div class="principle-icon"><i data-lucide="languages" style="width:16px;height:16px;color:var(--violet);"></i></div><div class="principle-content"><h4>Multilingue</h4><p>FR, EN, ES</p></div></div>
        <div class="card principle-card"><div class="principle-icon"><i data-lucide="banknote" style="width:16px;height:16px;color:var(--gold);"></i></div><div class="principle-content"><h4>Multi-devises</h4><p>MAD, EUR, USD</p></div></div>
        <div class="card principle-card"><div class="principle-icon"><i data-lucide="radio" style="width:16px;height:16px;color:var(--rose);"></i></div><div class="principle-content"><h4>Temps réel</h4><p>WebSocket Reverb</p></div></div>
        <div class="card principle-card"><div class="principle-icon"><i data-lucide="scroll-text" style="width:16px;height:16px;color:var(--cyan);"></i></div><div class="principle-content"><h4>Audit complet</h4><p>Qui, quoi, quand</p></div></div>
    </div>
</section><div class="divider"></div>

<!-- ===== 7 CHANNEX ===== -->
<section class="section" id="s7">
    <div class="section-header" data-aos="fade-up"><div class="section-icon"><i data-lucide="arrow-left-right" style="width:18px;height:18px;color:var(--text-3);"></i></div><div><div class="section-number">Section 07</div><h2 class="section-title">Intégration Channex</h2></div></div>

    <div class="flow-canvas" data-aos="fade-up">
        <div class="flow-header"><i data-lucide="monitor" style="width:14px;height:14px;"></i> Scénario 1 — Réservation Site<span class="badge">Web → OTAs</span><span class="zoom-hint"><i data-lucide="move" style="width:11px;height:11px;"></i> Pinch to zoom</span></div>
        <div class="flow-viewport" data-panzoom>
            <div class="flow-body" id="c1-flow" style="min-height:260px;padding:32px;">
                <svg class="connections" id="c1-svg"><defs><marker id="mc" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M0 0L10 5L0 10z" fill="#d1d5db"/></marker></defs></svg>
                <div class="flow-node" id="c1-a" style="top:14px;left:20px;"><div class="fn-icon"><i data-lucide="user" style="width:12px;height:12px;color:var(--accent);"></i></div><div class="fn-text"><div class="fn-title">Client</div></div></div>
                <div class="flow-node emerald" id="c1-b" style="top:14px;left:220px;"><div class="fn-icon"><i data-lucide="server" style="width:12px;height:12px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">API Backend</div><div class="fn-sub">Créer booking</div></div></div>
                <div class="flow-node gold" id="c1-c" style="top:14px;left:480px;"><div class="fn-icon"><i data-lucide="arrow-left-right" style="width:12px;height:12px;color:var(--gold);"></i></div><div class="fn-text"><div class="fn-title">Channex</div><div class="fn-sub">Déduire stock</div></div></div>
                <div class="flow-node" id="c1-d" style="top:14px;left:700px;"><div class="fn-icon"><i data-lucide="globe" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">OTAs</div><div class="fn-sub">Fermer dates</div></div></div>
                <div class="flow-node" id="c1-e" style="top:150px;left:120px;"><div class="fn-icon"><i data-lucide="check" style="width:12px;height:12px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">POST /bookings</div></div></div>
                <div class="flow-node" id="c1-f" style="top:150px;left:530px;"><div class="fn-icon"><i data-lucide="lock" style="width:12px;height:12px;color:var(--gold);"></i></div><div class="fn-text"><div class="fn-title">Sync disponibilité</div></div></div>
            </div>
        </div>
    </div>

    <div class="flow-canvas" data-aos="fade-up" data-aos-delay="50">
        <div class="flow-header"><i data-lucide="download" style="width:14px;height:14px;"></i> Scénario 2 — OTA Entrante<span class="badge">OTA → System</span><span class="zoom-hint"><i data-lucide="move" style="width:11px;height:11px;"></i> Pinch to zoom</span></div>
        <div class="flow-viewport" data-panzoom>
            <div class="flow-body" id="c2-flow" style="min-height:220px;padding:32px;">
                <svg class="connections" id="c2-svg"><defs><marker id="md" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M0 0L10 5L0 10z" fill="#d1d5db"/></marker></defs></svg>
                <div class="flow-node" id="c2-a" style="top:14px;left:700px;"><div class="fn-icon"><i data-lucide="globe" style="width:12px;height:12px;color:var(--violet);"></i></div><div class="fn-text"><div class="fn-title">OTA</div></div></div>
                <div class="flow-node gold" id="c2-b" style="top:14px;left:480px;"><div class="fn-icon"><i data-lucide="arrow-left-right" style="width:12px;height:12px;color:var(--gold);"></i></div><div class="fn-text"><div class="fn-title">Channex</div><div class="fn-sub">Webhook</div></div></div>
                <div class="flow-node emerald" id="c2-c" style="top:14px;left:220px;"><div class="fn-icon"><i data-lucide="server" style="width:12px;height:12px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">API Backend</div><div class="fn-sub">Créer + assigner</div></div></div>
                <div class="flow-node" id="c2-d" style="top:14px;left:20px;"><div class="fn-icon"><i data-lucide="bell" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Back-Office</div><div class="fn-sub">WebSocket</div></div></div>
                <div class="flow-node" id="c2-e" style="top:130px;left:350px;"><div class="fn-icon"><i data-lucide="check-circle" style="width:12px;height:12px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">Booking créé</div></div></div>
            </div>
        </div>
    </div>

    <div class="sub-title" data-aos="fade-up"><i data-lucide="network" style="width:15px;height:15px;"></i> Multi-Property</div>
    <div class="flow-canvas" data-aos="fade-up">
        <div class="flow-header"><i data-lucide="git-fork" style="width:14px;height:14px;"></i> Distribution<span class="badge">2 Hôtels</span><span class="zoom-hint"><i data-lucide="move" style="width:11px;height:11px;"></i> Pinch to zoom</span></div>
        <div class="flow-viewport" data-panzoom>
            <div class="flow-body" id="mp-flow" style="min-height:390px;padding:32px;">
                <svg class="connections" id="mp-svg"><defs><marker id="me" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M0 0L10 5L0 10z" fill="#d1d5db"/></marker></defs></svg>
                <div class="flow-node dark" id="m-bo" style="top:8px;left:350px;"><div class="fn-icon"><i data-lucide="layout-dashboard" style="width:12px;height:12px;color:rgba(255,255,255,.5);"></i></div><div class="fn-text"><div class="fn-title">Back-Office</div><div class="fn-sub">Sélecteur hôtel</div></div></div>
                <div class="flow-node gold" id="m-oa" style="top:100px;left:100px;"><div class="fn-icon"><i data-lucide="sun" style="width:12px;height:12px;color:var(--gold-light);"></i></div><div class="fn-text"><div class="fn-title">Oasis</div></div></div>
                <div class="flow-node accent" id="m-bp" style="top:100px;left:600px;"><div class="fn-icon"><i data-lucide="waves" style="width:12px;height:12px;color:var(--accent-light);"></i></div><div class="fn-text"><div class="fn-title">Blue Pearl</div></div></div>
                <div class="flow-node" id="m-c1" style="top:195px;left:100px;"><div class="fn-icon"><i data-lucide="arrow-left-right" style="width:12px;height:12px;color:var(--violet);"></i></div><div class="fn-text"><div class="fn-title">Channex Oasis</div></div></div>
                <div class="flow-node" id="m-c2" style="top:195px;left:600px;"><div class="fn-icon"><i data-lucide="arrow-left-right" style="width:12px;height:12px;color:var(--violet);"></i></div><div class="fn-text"><div class="fn-title">Channex BP</div></div></div>
                <div class="flow-node" id="m-o1" style="top:290px;left:20px;"><div class="fn-icon"><i data-lucide="globe" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Booking.com</div></div></div>
                <div class="flow-node" id="m-o2" style="top:290px;left:190px;"><div class="fn-icon"><i data-lucide="globe" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Expedia</div></div></div>
                <div class="flow-node" id="m-o3" style="top:290px;left:530px;"><div class="fn-icon"><i data-lucide="globe" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Booking.com</div></div></div>
                <div class="flow-node" id="m-o4" style="top:290px;left:700px;"><div class="fn-icon"><i data-lucide="globe" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Expedia</div></div></div>
            </div>
        </div>
    </div>
</section><div class="divider"></div>

<!-- ===== 8 PAYMENT ===== -->
<section class="section" id="s8">
    <div class="section-header" data-aos="fade-up"><div class="section-icon"><i data-lucide="wallet" style="width:18px;height:18px;color:var(--text-3);"></i></div><div><div class="section-number">Section 08</div><h2 class="section-title">Paiement</h2></div></div>
    <div class="flow-canvas" data-aos="fade-up">
        <div class="flow-header"><i data-lucide="credit-card" style="width:14px;height:14px;"></i> Flux 3D Secure<span class="badge">End-to-End</span><span class="zoom-hint"><i data-lucide="move" style="width:11px;height:11px;"></i> Pinch to zoom</span></div>
        <div class="flow-viewport" data-panzoom>
            <div class="flow-body" id="p-flow" style="min-height:420px;padding:32px;">
                <svg class="connections" id="p-svg"><defs><marker id="mf" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M0 0L10 5L0 10z" fill="#d1d5db"/></marker></defs></svg>
                <div class="flow-node" id="p-cl" style="top:8px;left:20px;"><div class="fn-icon"><i data-lucide="user" style="width:12px;height:12px;color:var(--accent);"></i></div><div class="fn-text"><div class="fn-title">Client</div></div></div>
                <div class="flow-node emerald" id="p-api" style="top:8px;left:220px;"><div class="fn-icon"><i data-lucide="server" style="width:12px;height:12px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">API Backend</div></div></div>
                <div class="flow-node gold" id="p-gw" style="top:8px;left:480px;"><div class="fn-icon"><i data-lucide="credit-card" style="width:12px;height:12px;color:var(--gold);"></i></div><div class="fn-text"><div class="fn-title">CMI / Stripe</div></div></div>
                <div class="flow-node" id="p-db" style="top:8px;left:700px;"><div class="fn-icon"><i data-lucide="database" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Database</div></div></div>
                <div class="flow-node" id="p-s1" style="top:120px;left:120px;"><div class="fn-icon"><i data-lucide="send" style="width:12px;height:12px;color:var(--accent);"></i></div><div class="fn-text"><div class="fn-title">① POST /bookings</div><div class="fn-sub">status → pending</div></div></div>
                <div class="flow-node" id="p-s2" style="top:220px;left:350px;"><div class="fn-icon"><i data-lucide="lock" style="width:12px;height:12px;color:var(--gold);"></i></div><div class="fn-text"><div class="fn-title">② Session 3DS</div><div class="fn-sub">Redirect paiement</div></div></div>
                <div class="flow-node emerald" id="p-s3" style="top:320px;left:120px;"><div class="fn-icon"><i data-lucide="check-circle" style="width:12px;height:12px;color:var(--emerald);"></i></div><div class="fn-text"><div class="fn-title">③ Webhook OK</div><div class="fn-sub">confirmed + sync</div></div></div>
                <div class="flow-node" id="p-s4" style="top:320px;left:530px;"><div class="fn-icon"><i data-lucide="mail" style="width:12px;height:12px;color:var(--text-3);"></i></div><div class="fn-text"><div class="fn-title">Email + Channex</div></div></div>
            </div>
        </div>
    </div>

    <div class="sub-title" data-aos="fade-up"><i data-lucide="settings-2" style="width:15px;height:15px;"></i> Configuration</div>
    <div class="grid-2" data-aos="fade-up">
        <div class="card pay-hotel"><h4><i data-lucide="sun" style="width:14px;height:14px;color:var(--gold-light);"></i> Oasis Beach</h4><div class="pay-row"><span class="label">Passerelle</span><span class="value">CMI ou Stripe</span></div><div class="pay-row"><span class="label">Acompte</span><span class="value">30%</span></div><div class="pay-row"><span class="label">3D Secure</span><span class="value">Obligatoire</span></div></div>
        <div class="card pay-hotel"><h4><i data-lucide="waves" style="width:14px;height:14px;color:var(--accent-light);"></i> Blue Pearl</h4><div class="pay-row"><span class="label">Passerelle</span><span class="value">CMI ou Stripe</span></div><div class="pay-row"><span class="label">Acompte</span><span class="value">Paiement total</span></div><div class="pay-row"><span class="label">3D Secure</span><span class="value">Obligatoire</span></div></div>
    </div>
</section><div class="divider"></div>

<!-- ===== 9 ===== -->
<section class="section" id="s9">
    <div class="section-header" data-aos="fade-up"><div class="section-icon"><i data-lucide="bell" style="width:18px;height:18px;color:var(--text-3);"></i></div><div><div class="section-number">Section 09</div><h2 class="section-title">Notifications & Emails</h2></div></div>
    <div class="sub-title" data-aos="fade-up"><i data-lucide="radio" style="width:15px;height:15px;"></i> In-App</div>
    <div class="grid-4" data-aos="fade-up">
        <div class="card notif-card"><div class="notif-icon"><i data-lucide="calendar-plus" style="width:14px;height:14px;color:var(--emerald);"></i></div><div class="notif-content"><h4>Nouvelle résa</h4><p>Admin</p></div></div>
        <div class="card notif-card"><div class="notif-icon"><i data-lucide="calendar-x" style="width:14px;height:14px;color:var(--rose);"></i></div><div class="notif-content"><h4>Annulation</h4><p>Motif</p></div></div>
        <div class="card notif-card"><div class="notif-icon"><i data-lucide="download" style="width:14px;height:14px;color:var(--violet);"></i></div><div class="notif-content"><h4>OTA</h4><p>Source</p></div></div>
        <div class="card notif-card"><div class="notif-icon"><i data-lucide="log-in" style="width:14px;height:14px;color:var(--accent);"></i></div><div class="notif-content"><h4>Arrivées</h4><p>Check-ins</p></div></div>
    </div>
    <div class="sub-title" style="margin-top:24px;" data-aos="fade-up"><i data-lucide="mail" style="width:15px;height:15px;"></i> Emails</div>
    <div data-aos="fade-up">
        <div class="card email-item" style="margin-bottom:6px;"><div class="flow-trigger"><i data-lucide="zap" style="width:13px;height:13px;"></i> created</div><div class="flow-email">Confirmation</div><div class="flow-desc">Récapitulatif</div></div>
        <div class="card email-item" style="margin-bottom:6px;"><div class="flow-trigger"><i data-lucide="clock" style="width:13px;height:13px;"></i> J-3</div><div class="flow-email">Pré-Séjour</div><div class="flow-desc">Upsell</div></div>
        <div class="card email-item" style="margin-bottom:6px;"><div class="flow-trigger"><i data-lucide="clock" style="width:13px;height:13px;"></i> J+1</div><div class="flow-email">Post-Séjour</div><div class="flow-desc">Avis</div></div>
        <div class="card email-item"><div class="flow-trigger"><i data-lucide="x-circle" style="width:13px;height:13px;"></i> cancelled</div><div class="flow-email">Annulation</div><div class="flow-desc">Remboursement</div></div>
    </div>
</section><div class="divider"></div>

<!-- ===== 10 ===== -->
<section class="section" id="s10">
    <div class="section-header" data-aos="fade-up"><div class="section-icon"><i data-lucide="shield-check" style="width:18px;height:18px;color:var(--text-3);"></i></div><div><div class="section-number">Section 10</div><h2 class="section-title">Sécurité & Audit</h2></div></div>
    <div class="sub-title" data-aos="fade-up"><i data-lucide="users" style="width:15px;height:15px;"></i> Rôles</div>
    <div data-aos="fade-up">
        <div class="card role-card"><div class="role-header"><span class="role-badge">Administrateur</span></div><div class="role-perms">Accès total</div><span class="role-scope"><i data-lucide="globe" style="width:11px;height:11px;"></i> Tous hôtels</span></div>
        <div class="card role-card"><div class="role-header"><span class="role-badge">Réceptionniste</span></div><div class="role-perms">Réservations, paiements</div><span class="role-scope"><i data-lucide="building-2" style="width:11px;height:11px;"></i> Hôtel assigné</span></div>
        <div class="card role-card"><div class="role-header"><span class="role-badge">Guest</span></div><div class="role-perms">Ses réservations</div><span class="role-scope"><i data-lucide="user" style="width:11px;height:11px;"></i> Public</span></div>
    </div>
    <div class="sub-title" style="margin-top:24px;" data-aos="fade-up"><i data-lucide="lock" style="width:15px;height:15px;"></i> Sécurité</div>
    <div class="grid-3" data-aos="fade-up">
        <div class="card sec-card"><i data-lucide="key-round" style="width:16px;height:16px;"></i><div><h4>JWT</h4><p>Expiration + refresh</p></div></div>
        <div class="card sec-card"><i data-lucide="shield" style="width:16px;height:16px;"></i><div><h4>RBAC</h4><p>Spatie</p></div></div>
        <div class="card sec-card"><i data-lucide="building-2" style="width:16px;height:16px;"></i><div><h4>Scope</h4><p>Property middleware</p></div></div>
        <div class="card sec-card"><i data-lucide="gauge" style="width:16px;height:16px;"></i><div><h4>Rate Limit</h4><p>10k/jour</p></div></div>
        <div class="card sec-card"><i data-lucide="shield-check" style="width:16px;height:16px;"></i><div><h4>SSL + CSP</h4><p>Headers</p></div></div>
        <div class="card sec-card"><i data-lucide="binary" style="width:16px;height:16px;"></i><div><h4>Encrypt</h4><p>Clés API</p></div></div>
    </div>
    <div class="sub-title" style="margin-top:24px;" data-aos="fade-up"><i data-lucide="scroll-text" style="width:15px;height:15px;"></i> Audit</div>
    <div class="audit-box" data-aos="fade-up">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px;"><i data-lucide="file-search" style="width:14px;height:14px;color:#d4a843;"></i> Exemple</div>
        <div class="audit-row"><span class="audit-label">User</span><span class="audit-value">Ahmed Benali</span></div>
        <div class="audit-row"><span class="audit-label">Action</span><span class="audit-value gold">updated</span></div>
        <div class="audit-row"><span class="audit-label">Model</span><span class="audit-value">PricingRule #12</span></div>
        <div class="audit-row"><span class="audit-label">Old</span><span class="audit-value red">{"value": 1200}</span></div>
        <div class="audit-row"><span class="audit-label">New</span><span class="audit-value green">{"value": 1500}</span></div>
        <div class="audit-row"><span class="audit-label">Date</span><span class="audit-value">2026-02-15 14:32:08</span></div>
        <div class="audit-row"><span class="audit-label">Property</span><span class="audit-value">Oasis Beach</span></div>
    </div>
</section>

</main>

<footer class="footer">
    <p><strong>16/02/2026</strong> · Architecture cible · <strong>Oasis Beach & Spa | Blue Pearl Beach</strong> · Laravel 11</p>
</footer>

<script>
lucide.createIcons();
AOS.init({ once: true, offset: 40, duration: 450, easing: 'ease-out-cubic' });

// ===== Panzoom Init =====
const panzoomInstances = [];
document.querySelectorAll('[data-panzoom]').forEach(viewport => {
    const flowBody = viewport.querySelector('.flow-body');
    if (!flowBody) return;

    const instance = Panzoom(flowBody, {
        maxScale: 3,
        minScale: 0.3,
        startScale: 1,
        contain: 'outside',
        canvas: true,
    });

    viewport.addEventListener('wheel', (e) => {
        instance.zoomWithWheel(e);
    });

    panzoomInstances.push({ instance, viewport, flowBody });

    // On mobile, auto-fit scale
    function fitScale() {
        const vw = viewport.clientWidth;
        const fw = flowBody.scrollWidth || 900;
        if (vw < fw) {
            const scale = Math.max(0.35, vw / fw);
            instance.zoom(scale, { animate: false });
            instance.pan(0, 0, { animate: false });
        } else {
            instance.zoom(1, { animate: false });
            instance.pan(0, 0, { animate: false });
        }
    }

    // Wait for layout
    setTimeout(fitScale, 300);
    window.addEventListener('resize', () => {
        clearTimeout(viewport._ft);
        viewport._ft = setTimeout(fitScale, 200);
    });
});

// ===== SVG Connections =====
function gp(el, cont, anchor) {
    if (!el || !cont) return null;
    const r = el.getBoundingClientRect(), c = cont.getBoundingClientRect();
    const x = r.left - c.left, y = r.top - c.top, w = r.width, h = r.height;
    switch(anchor) {
        case 'b': return { x: x + w/2, y: y + h };
        case 't': return { x: x + w/2, y: y };
        case 'r': return { x: x + w, y: y + h/2 };
        case 'l': return { x: x, y: y + h/2 };
        default: return { x: x + w/2, y: y + h };
    }
}
function dp(svg, f, t, mid) {
    if (!f || !t) return;
    const dx = t.x - f.x, dy = t.y - f.y;
    let d;
    if (Math.abs(dy) > Math.abs(dx) * 0.3) {
        const m = f.y + dy * 0.5;
        d = `M${f.x},${f.y}C${f.x},${m} ${t.x},${m} ${t.x},${t.y}`;
    } else {
        const m = f.x + dx * 0.5;
        d = `M${f.x},${f.y}C${m},${f.y} ${m},${t.y} ${t.x},${t.y}`;
    }
    const p = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    p.setAttribute('d', d);
    p.setAttribute('stroke', '#d1d5db');
    p.setAttribute('marker-end', `url(#${mid})`);
    svg.appendChild(p);
}
function cl(svg) { svg.querySelectorAll('path:not(defs path)').forEach(p => p.remove()); }

function draw() {
    const sets = [
        { body: 'arch-flow', svg: 'arch-svg', mid: 'ma', edges: [
            ['a-oasis','a-api','b','t'],['a-blue','a-api','b','t'],['a-bo','a-api','b','t'],
            ['a-api','a-ch','b','t'],['a-api','a-pay','b','t'],['a-api','a-mail','b','t'],
            ['a-api','a-db','b','t'],['a-api','a-redis','b','t'],['a-ch','a-otas','b','t']
        ]},
        { body: 'c1-flow', svg: 'c1-svg', mid: 'mc', edges: [
            ['c1-a','c1-b','r','l'],['c1-b','c1-c','r','l'],['c1-c','c1-d','r','l'],
            ['c1-b','c1-e','b','t'],['c1-c','c1-f','b','t']
        ]},
        { body: 'c2-flow', svg: 'c2-svg', mid: 'md', edges: [
            ['c2-a','c2-b','l','r'],['c2-b','c2-c','l','r'],['c2-c','c2-d','l','r'],
            ['c2-c','c2-e','b','t'],['c2-b','c2-e','b','t']
        ]},
        { body: 'mp-flow', svg: 'mp-svg', mid: 'me', edges: [
            ['m-bo','m-oa','b','t'],['m-bo','m-bp','b','t'],
            ['m-oa','m-c1','b','t'],['m-bp','m-c2','b','t'],
            ['m-c1','m-o1','b','t'],['m-c1','m-o2','b','t'],
            ['m-c2','m-o3','b','t'],['m-c2','m-o4','b','t']
        ]},
        { body: 'p-flow', svg: 'p-svg', mid: 'mf', edges: [
            ['p-cl','p-api','r','l'],['p-api','p-gw','r','l'],['p-gw','p-db','r','l'],
            ['p-cl','p-s1','b','t'],['p-api','p-s1','b','l'],
            ['p-s1','p-s2','b','t'],['p-gw','p-s2','b','t'],
            ['p-s2','p-s3','b','t'],['p-s3','p-s4','r','l']
        ]}
    ];

    sets.forEach(s => {
        const body = document.getElementById(s.body);
        const svg = document.getElementById(s.svg);
        if (!body || !svg) return;
        cl(svg);
        s.edges.forEach(([a, b, fa, fb]) => {
            dp(svg, gp(document.getElementById(a), body, fa), gp(document.getElementById(b), body, fb), s.mid);
        });
    });
}

window.addEventListener('load', () => setTimeout(draw, 600));
window.addEventListener('resize', () => { clearTimeout(window._r); window._r = setTimeout(draw, 200); });

// Active nav
const ss = document.querySelectorAll('.section');
const ls = document.querySelectorAll('.nav a');
const ob = new IntersectionObserver(es => {
    es.forEach(e => {
        if (e.isIntersecting) {
            ls.forEach(l => l.classList.remove('active'));
            const a = document.querySelector(`.nav a[href="#${e.target.id}"]`);
            if (a) a.classList.add('active');
        }
    });
}, { threshold: 0.2 });
ss.forEach(s => ob.observe(s));
</script>
</body>
</html>
